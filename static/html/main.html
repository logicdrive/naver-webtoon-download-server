<!DOCTYPE html>
<html>
    <head>
        <title>Main</title>
    </head>
    <body>
        <form id="title_search_form">
          <input type="text"/>
          <input type="submit" value="웹툰명 검색"/>
        </form>
        <table id="title_result_table">
        </table>
    </body>
    <script>
      document.querySelector("#title_search_form").addEventListener("submit", async (e) => {
          e.preventDefault()
          
          const SEARCH_TITLE = document.querySelector("#title_search_form input[type='text']").value
          if(SEARCH_TITLE.length == 0)
          {
            alert("검색할 웹툰명을 입력해주세요!")
            return
          }

          const RES = await Request.JSON_Request(`/api/v1/webtoon?type=title&keyword=${SEARCH_TITLE}`, "GET")
          if(RES.is_error)
          {
            alert(`에러가 발생했습니다!\n${RES.message}`)
            return
          }

          const SEARCH_RESULTS = RES.result
          if(SEARCH_RESULTS.length == 0)
          {
            alert("검색결과가 존재하지 않습니다! 검색할 웹툰명이 정확한지 확인해주세요!")
            return
          }

          const TITLE_RESULT_TABLE_SEL = document.querySelector("#title_result_table")
          const SEARCH_RESULT_HTMLS = SEARCH_RESULTS.map((search_result) => 
            `<tr><td><div title_id="${search_result.title_id}">${search_result.title}</div></td></tr>`)
          TITLE_RESULT_TABLE_SEL.innerHTML = SEARCH_RESULT_HTMLS.join('\n')

          Object.values(document.querySelectorAll("#title_result_table td div")).forEach((sel) => {
              sel.addEventListener("click", (e) => {
                  alert(`[MOCK] ${e.path[0].textContent}(${e.path[0].getAttribute("title_id")}) 에 대한 세부 화수 조회 결과가 나와야 함`)
              })
          })
      })

      class Request
      {
        // 특정 HTTP 요청 형태에 대해서 JSON Body로 요청하고, JSON 형태로 데이터를 받기 위해서
        static async JSON_Request(url, request_type, json_body={})
        {
          const HTTP_REQUEST_TYPES = ["GET", "HEAD", "PUT", "POST", "DELETE", "TRACE", "CONNECT", "OPTIONS"]
          if(!HTTP_REQUEST_TYPES.includes(request_type.toUpperCase()))
            throw new Error("request_type에는 알맞은 HTTP 요청타입이 들어가야 합니다!")

          let request_infos = {
            method: request_type,
            headers: { "Content-Type": "application/json" }
          }
          if(!["GET", "HEAD", "DELETE", "TRACE"].includes(request_type))
            request_infos.body = JSON.stringify(json_body)

          return (await fetch(url, request_infos)).json()
        }
      }
    </script>
</html>